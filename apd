#!/bin/bash
# ===============================================
# Author: aliazhar < aliazhar0555@gmail.com >
# Contributor: -
# License: GNU General Public License v2.0
# ===============================================


# {[IMPORTANT]} Where PKGBUILD and clones will be stored; cDir which means 'cache directory'.
cDir=~/Packages
 
# Check if argument/package name is specified or not.
if [ $# -eq 0 ] || [ $1 == "-h" ];
  then
    printf "Error: Wrong/Missing Options.\n\nUsage: apd [options/AUR name] \n\nOptions:\n  -h     :     Show this help message and exit. \n  -i     :     Install package after successful build.\n"
    exit 1;
fi

# Check if cache directory exists or not
if ! [ -d $cDir ];
  then
    printf "Error: Cache directory not found"
    printf "run 'mkdir -p $cDir' to solve it"
    exit 1;
fi

if [ "$*" == "-i $2" ]; 
  then
    packageName=$2
    apdParams='-si'
    msg='APD has successfully build and install the packages :)\n'
  else
    packageName=$@
    apdParams='-s'
    msg='APD has successfully build the packages :)\n'
fi

# Check if directory with package name exists or not
! [ -d $cDir/$packageName ] && git -C $cDir clone https://aur.archlinux.org/$packageName

if [[ -e $cDir/$packageName/"PKGBUILD" ]]; 
  then
    cd $cDir/$packageName
    makepkg $apdParams;
    printf "$msg"
  else
    rm -rf $cDir/$packageName
    printf ". . . APD Failed . . .\n"
fi
